{% extends "base.html" %}

{% block title %}{{ title }} - Devil2Devil Store{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <!-- Header -->
    <div class="text-center mb-8">
        <h1 class="text-3xl font-bold flex items-center justify-center">
            {% if product %}
                <i class="fas fa-edit text-yellow-400 mr-3"></i>
                Edit Product
            {% else %}
                <i class="fas fa-plus text-yellow-400 mr-3"></i>
                Add New Product
            {% endif %}
        </h1>
        <p class="text-muted mt-2">
            {% if product %}
                Update product information and availability
            {% else %}
                Create a new product for your Devil2Devil store
            {% endif %}
        </p>
    </div>

    <!-- Product Form -->
    <div class="card p-8">
        <form method="POST" enctype="multipart/form-data" class="space-y-6">
            <!-- Product Name -->
            <div>
                <label for="name" class="block text-sm font-semibold mb-2 asu-gold">
                    <i class="fas fa-tag mr-2"></i>Product Name *
                </label>
                <input type="text" 
                       id="name" 
                       name="name" 
                       value="{{ product.name if product else '' }}" 
                       required 
                       maxlength="100"
                       class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent text-white placeholder-gray-400"
                       placeholder="Enter product name">
                <p class="text-sm text-muted mt-1">Enter a clear, descriptive name for your product</p>
            </div>

            <!-- Description -->
            <div>
                <label for="description" class="block text-sm font-semibold mb-2 asu-gold">
                    <i class="fas fa-align-left mr-2"></i>Description
                </label>
                <textarea id="description" 
                          name="description" 
                          rows="4"
                          class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent text-white placeholder-gray-400 resize-vertical"
                          placeholder="Describe your product...">{{ product.description if product else '' }}</textarea>
                <p class="text-sm text-muted mt-1">Provide details about what customers will receive</p>
            </div>

            <!-- Price -->
            <div>
                <label for="price" class="block text-sm font-semibold mb-2 asu-gold">
                    <i class="fas fa-coins mr-2"></i>Price (Points) *
                </label>
                <input type="number" 
                       id="price" 
                       name="price" 
                       value="{{ product.price if product else '' }}" 
                       required 
                       min="1" 
                       step="1"
                       class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent text-white placeholder-gray-400"
                       placeholder="0">
                <p class="text-sm text-muted mt-1">How many points will this product cost?</p>
            </div>

            <!-- Stock -->
            <div>
                <label for="stock" class="block text-sm font-semibold mb-2 asu-gold">
                    <i class="fas fa-boxes mr-2"></i>Stock Quantity
                </label>
                <input type="number" 
                       id="stock" 
                       name="stock" 
                       value="{{ product.stock if product else '0' }}" 
                       min="0" 
                       step="1"
                       class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent text-white placeholder-gray-400"
                       placeholder="0">
                <p class="text-sm text-muted mt-1">How many of this product are available? (0 for unlimited)</p>
            </div>

            <!-- Image Upload -->
            <div>
                <label for="image" class="block text-sm font-semibold mb-2 asu-gold">
                    <i class="fas fa-image mr-2"></i>Product Image
                </label>
                
                <!-- Current Image Preview -->
                {% if product and product.image_url %}
                    <div class="mb-4 p-4 bg-gray-800 border border-gray-600 rounded-lg">
                        <div class="flex items-center space-x-4">
                            <img src="{{ url_for('static', filename='uploads/' + product.image_url) }}" 
                                 alt="Current image" 
                                 class="w-24 h-24 object-cover rounded-lg border border-gray-600">
                            <div>
                                <p class="font-semibold">Current Image</p>
                                <p class="text-sm text-muted">Upload a new image to replace it</p>
                            </div>
                        </div>
                    </div>
                {% endif %}

                <!-- File Upload Area -->
                <div class="file-upload-wrapper">
                    <input type="file" 
                           id="image" 
                           name="image" 
                           accept="image/*"
                           class="hidden">
                    <label for="image" 
                           class="file-upload-label block w-full p-8 border-2 border-dashed border-gray-600 rounded-lg text-center cursor-pointer transition-all duration-300 hover:border-yellow-400 hover:bg-gray-800">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-500 mb-4"></i>
                        <div class="text-lg font-semibold mb-2">Click to upload image</div>
                        <div class="text-sm text-muted">
                            <span class="selected-file-name">PNG, JPG, JPEG, GIF, WebP up to 16MB</span>
                        </div>
                    </label>
                </div>
                <p class="text-sm text-muted mt-2">Add an attractive image to showcase your product</p>
            </div>

            <!-- Form Actions -->
            <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-600">
                <button type="submit" class="btn-primary flex-1">
                    {% if product %}
                        <i class="fas fa-save mr-2"></i>Update Product
                    {% else %}
                        <i class="fas fa-plus mr-2"></i>Create Product
                    {% endif %}
                </button>
                                 <a href="{{ url_for('admin_panel') }}" class="btn-secondary flex-1 text-center">
                    <i class="fas fa-times mr-2"></i>Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<script>
// File upload preview functionality
document.getElementById('image').addEventListener('change', function(e) {
    const label = document.querySelector('.file-upload-label');
    const fileName = document.querySelector('.selected-file-name');
    
    if (e.target.files.length > 0) {
        const file = e.target.files[0];
        const fileSize = (file.size / 1024 / 1024).toFixed(2); // Size in MB
        
        label.classList.add('border-green-500', 'bg-green-900', 'bg-opacity-20');
        label.classList.remove('border-gray-600');
        
        fileName.innerHTML = `
            <div class="text-green-400 font-semibold">${file.name}</div>
            <div class="text-sm text-gray-400">${fileSize} MB</div>
        `;
        
        // Update icon
        label.querySelector('i').className = 'fas fa-check-circle text-4xl text-green-400 mb-4';
        label.querySelector('.text-lg').textContent = 'File selected';
    } else {
        label.classList.remove('border-green-500', 'bg-green-900', 'bg-opacity-20');
        label.classList.add('border-gray-600');
        
        fileName.textContent = 'PNG, JPG, JPEG, GIF, WebP up to 16MB';
        
        // Reset icon
        label.querySelector('i').className = 'fas fa-cloud-upload-alt text-4xl text-gray-500 mb-4';
        label.querySelector('.text-lg').textContent = 'Click to upload image';
    }
});
</script>
{% endblock %} 